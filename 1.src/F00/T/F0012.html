<!DOCTYPE html>
<html>
<head>
    <title>中量大教务处微信服务平台</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
     <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/wxcss.css" rel="stylesheet">
</head>
<body ontouchstart class="user-body">
<form id="itemdata" class="form-horizontal">
    <div class="page__bd">
    <div class="weui-cells weui-cells_form">
      <div class="weui-cell">
        <div class="weui-cell__hd">
            <label class="weui-label">会议室：</label>
        </div>
        <div class="weui-cell__bd">
            <select class="weui-input">
                <option value="">请选择会议室</option>
                <option>T400</option>
                <option>T403</option>
                <option>J515</option>
                <option>C616</option>
            </select>
        </div>
      </div>
      <div class="weui-cell">
        <div class="weui-cell__hd"><label for="" class="weui-label">日期</label></div>
        <div class="weui-cell__bd">
          <input class="weui-input" type="date" value="">
        </div>
      </div>
      <div class="weui-cell">
        <div class="weui-cell__hd"><label for="" class="weui-label">时间</label></div>
        <div class="weui-cell__bd">
            <div class="weui-cell"><input class="weui-input" type="time" value="" placeholder="开始时间">~<input class="weui-input" type="time" value="" placeholder="结束时间"></div>
        </div>
      </div>
    </div>

    <div class="weui-cells__title">借用理由</div>
    <div class="weui-cells weui-cells_form">
      <div class="weui-cell">
        <div class="weui-cell__bd">
          <textarea class="weui-textarea" placeholder="请输入文本" rows="3"></textarea>
          <div class="weui-textarea-counter"><span>0</span>/200</div>
        </div>
      </div>
    </div>
    </div>
    <div class="weui-cells__tips"><pre>预约说明:预约时间最多提前10天
钥匙领取:格中418-1 柳老师
电话: 15267173532 (673532)
请提前10-20分钟领取钥匙,如有改变请电话确认。</pre>
    </div>
    <div class="weui-cells__title">表单报错</div>
    <div class="weui-cells weui-cells_form">
      <div class="weui-cell weui-cell_warn">
        <div class="weui-cell__hd"><label for="" class="weui-label">卡号</label></div>
        <div class="weui-cell__bd">
          <input class="weui-input" type="number" pattern="[0-9]*" value="weui input error" placeholder="请输入卡号">
        </div>
        <div class="weui-cell__ft">
          <i class="weui-icon-warn"></i>
        </div>
      </div>
    </div>

</form>
</body>
<script>
        var vm = null;
        function formcheck() {
            var regBox = {
                regApply: /^[a-z0-9_-\u4E00-\u9FA5]{3,500}$/,//用途
                regMobile: /^0?1[3|4|5|8][0-9]\d{8}$/,//手机
                regTel: /^[\d]{6}$/,
                regName: /^[\u4E00-\u9FA5]{2,5}$/
            };
            if (vm.row.the_memo == "" || vm.row.username == "" || vm.row.phoneno == "") {
                alert('还有内容没填完哦！');
                return false;
            }

            if (vm.row.the_memo.length < 5) {
                alert('用途不够详细');
                return false;
            }

            if (!regBox.regName.test(vm.row.applyuser)) {
                alert("姓名好好填！");
                return false;
            }

            var mflag = regBox.regMobile.test(vm.row.phoneno);
            var tflag = regBox.regTel.test(vm.row.phoneno);

            if (!(mflag || tflag)) {
                alert("长号或者短号有误！");
                return false;
            }

            var strhour = parseFloat(vm.row.starthour);
            var strmin = parseFloat(vm.row.startmin);
            var endhour = parseFloat(vm.row.endhour);
            var endmin = parseFloat(vm.row.endmin);

            if ((strhour * 60 + strmin) >= (endhour * 60 + endmin)) {
                alert('你输入的时间段不合理');
                return false;
            }
            if ((endhour * 60 + endmin) - (strhour * 60 + strmin) < 10) {
                alert('使用时间是不是太短了');
                return false;
            }
            return true;
        }
        var the_row = {
                        id          : '${i.get("id",0)}',
                        cmd         : '${i.get("cmd","add")}',
                        roomno      : '${i.get("roomno","")}',
                        the_date    : '${i.get("the_date","")}',
                        the_memo    : '${i.get("the_memo","")}',
                        applyuser   : '${i.get("applyuser","")}',
                        starthour   : '${i.get("starthour","")}',
                        startmin    : '${i.get("startmin","")}',
                        endhour     : '${i.get("endhour","")}',
                        endmin      : '${i.get("endmin","")}',
                        phoneno     : '${i.get("phoneno","")}'
        };

        $(function(){

            vm = new Vue({
                el:"#itemdata",
                data:{
                    hours:['08','09','10','11','12','13','14','15','16','17','18','19','20','21','22'],
                    mins:['00','15','30','45'],
                    row:the_row
                },
                methods:{
                    dosubmit:function(event){
                        r = formcheck();
                        if (r){
                            console.log(vm.row);
                            $.post("/F0012/ajax",vm.row,function(r){
                                if(r.result=="OK"){
                                    alert("预约成功！");
                                }
                            },"json");
                        }

                    },
                },
            });
            laydate.render({
                  elem: '#the_date'
                  ,min: 0 //7天前
                  ,max: 10 //7天后
                  ,done: function(value, date, endDate){
                      vm.row.the_date = value;
                  }
                });
        });
    </script>
</html>